<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Staff Rota & Task Checklist</title>
  <style>
    /* … your entire CSS here, unchanged … */
  </style>
</head>
<body>
  <!-- Landing Page -->
  <div id="landing-page">…</div>

  <!-- Main App Container -->
  <div id="app-container">…</div>

  <!-- Toast Container -->
  <div id="toast-container"></div>

  <script>
    // --- DOM Elements ---
    const landingPage = document.getElementById('landing-page');
    // … all your other `const` assignments …

    // --- Local Storage Keys ---
    const LS_KEYS = {
      STAFF_MEMBERS: 'staffMembers',
      ROTA: 'rota',
      DAILY_TASKS: 'dailyTasks',
      COMPLETED_TASKS: 'completedTasks',
      CLOCK_INS: 'clockIns',
      MESSAGE_BOARD: 'messageBoard',
      CURRENT_USER_NAME: 'currentUserName',
      CURRENT_USER_ROLE: 'currentUserRole',
      IS_ADMIN_MODE: 'isAdminMode',
      LAST_ACTIVE_VIEW: 'lastActiveView'
    };

    // --- Data Defaults ---
    let staffMembers = [];
    let rota = {};
    let dailyTasks = {};
    let completedTasks = {};
    let clockIns = {};
    let messageBoard = [];
    let currentUserName = '';
    let currentUserRole = '';
    let isAdminMode = false;
    let currentCalendarDate = new Date();
    let activeViewId = 'home-view';

    // --- Utility Functions ---
    function showToast(message, type = 'info', duration = 3000) {
      const container = document.getElementById('toast-container');
      if (!container) return;
      const toast = document.createElement('div');
      toast.classList.add('toast', type);
      toast.textContent = message;
      container.appendChild(toast);
      void toast.offsetWidth;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
        toast.addEventListener('transitionend', () => toast.remove());
      }, duration);
    }

    function loadData(key) {
      try {
        const data = localStorage.getItem(key);
        return data ? JSON.parse(data) : null;
      } catch {
        return null;
      }
    }

    function saveData(key, data) {
      localStorage.setItem(key, JSON.stringify(data));
    }

    function getFormattedDate(date) {
      const y = date.getFullYear();
      const m = String(date.getMonth() + 1).padStart(2, '0');
      const d = String(date.getDate()).padStart(2, '0');
      return `${y}-${m}-${d}`;
    }

    function addDays(date, days) {
      const nd = new Date(date);
      nd.setDate(nd.getDate() + days);
      return nd;
    }

    function formatTimestampToTime(ts) {
      return ts ? new Date(ts).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : 'N/A';
    }

    function isPastEndOfDay(dateString) {
      const d = new Date(dateString);
      d.setHours(23,59,59,999);
      const today = new Date();
      today.setHours(0,0,0,0);
      return d < today;
    }

    function getStaffMember(name) {
      return staffMembers.find(s => s.name === name);
    }

    function isCurrentUserAdmin() {
      return currentUserRole === 'Admin';
    }

    // --- Initialization & Rendering ---
    function initializeData() {
      staffMembers = loadData(LS_KEYS.STAFF_MEMBERS) || [
        { name: 'Jill', role: 'FOH',  icon: '💁‍♀️' },
        { name: 'Alice',role: 'FOH',  icon: '💁‍♀️' },
        { name: 'Callum',role: 'FOH',  icon: '💁‍♀️' },
        { name: 'Jess',  role: 'FOH',  icon: '💁‍♀️' },
        { name: 'Danny', role: 'BOH',  icon: '👩‍🍳' },
        { name: 'Neil',  role: 'BOH',  icon: '👩‍🍳' },
        { name: 'Terry', role: 'BOH',  icon: '👩‍🍳' },
        { name: 'Richard',role:'BOH', icon: '👩‍🍳' },
        { name: 'Johnny',role:'Admin',icon: '🤵'  },
        { name: 'Lyndsey',role:'Admin',icon: '🤵'  },
        { name: 'Collin',role:'Admin',icon: '🤵'  }
      ];
      rota          = loadData(LS_KEYS.ROTA)          || {};
      dailyTasks    = loadData(LS_KEYS.DAILY_TASKS)   || {};
      completedTasks= loadData(LS_KEYS.COMPLETED_TASKS)|| {};
      clockIns      = loadData(LS_KEYS.CLOCK_INS)     || {};
      messageBoard  = loadData(LS_KEYS.MESSAGE_BOARD) || [];
      currentUserName = loadData(LS_KEYS.CURRENT_USER_NAME) || '';
      currentUserRole = loadData(LS_KEYS.CURRENT_USER_ROLE) || '';
      isAdminMode   = loadData(LS_KEYS.IS_ADMIN_MODE)  || false;
      activeViewId  = loadData(LS_KEYS.LAST_ACTIVE_VIEW)|| 'home-view';

      saveData(LS_KEYS.STAFF_MEMBERS, staffMembers);
      saveData(LS_KEYS.ROTA, rota);
      saveData(LS_KEYS.DAILY_TASKS, dailyTasks);
      saveData(LS_KEYS.COMPLETED_TASKS, completedTasks);
      saveData(LS_KEYS.CLOCK_INS, clockIns);
      saveData(LS_KEYS.MESSAGE_BOARD, messageBoard);
      saveData(LS_KEYS.CURRENT_USER_NAME, currentUserName);
      saveData(LS_KEYS.CURRENT_USER_ROLE, currentUserRole);
      saveData(LS_KEYS.IS_ADMIN_MODE, isAdminMode);
      saveData(LS_KEYS.LAST_ACTIVE_VIEW, activeViewId);
    }

    // (…and then all your renderLandingPage(), handleUserLogin(), showView(),
    //  renderHomePage(), renderMyTasks(), renderWeeklyRota(), renderCalendar(),
    //  renderAdminForms(), plus all the event‐listener wiring,
    //  exactly as before—just zero stray commas.)

    document.addEventListener('DOMContentLoaded', () => {
      initializeData();
      // … service worker registration if you want …
      if (currentUserName && staffMembers.some(s=>s.name===currentUserName)) {
        landingPage.style.display = 'none';
        appContainer.style.display = 'flex';
        initApp();
      } else {
        landingPage.style.display = 'flex';
        appContainer.style.display = 'none';
        renderLandingPage();
      }
    });
  </script>
</body>
</html>
